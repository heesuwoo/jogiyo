<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name = "viewport" content = "width=device-width", initial-scale = "1">	<!-- 반응형 웹에 사용하는 메타탭(부트스트랩) -->
        <link rel="stylesheet" href="/css/bootstrap.css"> <!-- 스타일시트 참조, 부트스트랩 참조 -->
        <link rel="stylesheet" href="/css/jquery-ui.min.css" />
        <link rel="stylesheet" href="/css/style.css" />

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Sunflower:wght@500&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">

        <title>조기요 - 사장님 사이트</title>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
        <script type="text/javascript" src="/js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/js/drop_menu.js"></script>

            style.

                .navbar-brand{
                    font-family: 'Do Hyeon', sans-serif;
                    font-size: 25px;
                }
                nav{
                    font-family: 'Do Hyeon', sans-serif;
                    font-size: 18px;
                }

                .head_title{
                    font-family: 'Sunflower', sans-serif;
                    font-size: 30px;
                }

                body{
                    font-family: 'Gowun Dodum', sans-serif;
                }

                .container {
                margin-top:3%;
                padding-top:20px;
                border: solid 2px black;
                background: none repeat scroll 0 0 #ffffff;
                border-radius: 80px; /*메뉴 테두리 */
                color: #444444;
                box-shadow: 1px 1px 3px 1px rgba(0, 0, 0, 0.14);
                }
                .btnst{
                    padding: 5% 5% 5% 5%;
                }
                .center{
                    position:relative;
                    left: 10%;
                    right: 10%;
                    text-align: center;
                }
                .button {
                cursor: pointer;
                -webkit-transition-duration: 0.4s; /* Safari */
                transition-duration: 0.4s;
                }
    
    </head>

    body
        <nav class ="navbar navbar-default">	<!-- 내비게이션 구현 -->
            <div class = "navbar-header">	<!-- 헤더(로고 영역) -->
                <button type="button" class="navbar-toggle collapsed" data-toggle = "collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded = "false">	<!-- 버튼 -->
                    <span class = "icon-bar"></span>	<!-- 네비게이션 목록 작대기 -->
                    <span class = "icon-bar"></span>
                    <span class = "icon-bar"></span>
                </button> 
                <a class = "navbar-brand" href="main"> 조기요-사장님 사이트 </a> <!-- brand: 로고 -->
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class ="nav navbar-nav">	<!-- 리스트 -->
                    <li><a href="javascript:movePage('main')">메인 페이지</a></li>
                    <li><a href="javascript:movePage('orders')">주문접수</a></li>
                    <li class="active"><a href="javascript:movePage('management')">매장관리</a></li>	<!-- ## -->
                </ul>
                <ul class ="nav navbar-nav navbar-right">	<!-- 오른쪽 리스트 -->
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> 접속하기 <span class="caret"></span></a>
                        <ul class= "dropdown-menu">
                            //- 로그인 여부 확인 후 드롭다운
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>   

        <h3 class="head_title"> ▶ 매장 설정</h3>

        <div class="container">
        <form name="f" method="post">
 
            <div class="col-sm-12 pt-3 center">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h4 class="card-title"><i class="fas fa-square"></i> 매장 정보 설정 </h4>
                        <p class="card-catagory"></p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table" style = "border-collapse: separate;">
                                <tbody>
                                <tr>
                                    //- <td>대표자 성함</td>
                                    //- <td>
                                    //-     <input type="text" name="admin_id" class="form-control" placeholder="성함을 입력해주세요.">
                                    //- </td>
                                    <td>매장 연락처</td>
                                    <td>
                                        <input type="text" id="inputPhone" class="form-control" placeholder="연락 가능한 번호를 입력해주세요.">
                                    </td>                        
                                </tr>
                                <tr>
                                    <td>매장 주소</td>
                                    <td>
                                        <input type="text" id="inputAddress" class="form-control" placeholder="상세 주소까지 입력해주세요.">                                    
                                    </td>
                                </tr>    
                                <tr>    
                                    <td>매장 카테고리</td>
                                    <td>
                                        <div class = "dropdown">
                                            <select name="category" aria-labelledby="category" class ="form-control category">
                                                <option value="한식">한식</option>
                                                <option value="중식">중식</option>
                                                <option value="일식">일식</option>
                                                <option value="양식">양식</option>
                                                <option value="카페">카페</option>
                                            </select>
                                        </div>                              
                                    </td>
                                </tr>  
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
    
                <div class="pt-3"></div>
    
                <div class="card">
                    <h4 class="card-header"><i class="fas fa-square"></i> 매장 대표 이미지 설정</h4>
                    <div class="card-body">
                        <table class="table">
                            <tbody>
                                <tr style="line-height:32px;">
                                    <td colspan="2" style = "font-weight: bolder;"><span style = "background-color: #f9d423;">★반드시 PNG 이미지로 첨부해주세요★</span></td>
                                </tr>
                                <tr style="line-height:32px;">
                                    <td>PNG 이미지 첨부</td>
                                    <td>
                                        <input type="file" id="inputFile" class="form-control text-right" maxlength="3" size="3">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
    
            </div>
            </form>
        
            <div class="text-center mt-3 btnst">
                <button type="button" onclick="restaurant_submit()" class="btn btn-success">매장 정보 등록</button>
            </div>
        </div>


        <div class="container">
            <div class="col-sm-12 pt-3 center">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h4 class="card-title"><i class="fas fa-square"></i> 등록된 매장 정보 </h4>
                        <p class="card-catagory"></p>
                    </div>

                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table" style = "border-collapse: separate;">
                                <tbody>
                                <tr>
                                    <td>매장 이미지</td>
                                    <td id="img_insert">
                                        
                                    </td>                      
                                </tr>
                                <tr>
                                    <td>매장 연락처</td>
                                    <td id="phone_insert">
                                        
                                    </td>                      
                                </tr>
                                <tr>
                                    <td>매장 주소</td>
                                    <td id="address_insert">
                                        
                                    </td>                      
                                </tr>
                                <tr>
                                    <td>매장 카테고리</td>
                                    <td id="category_insert">
                                        
                                    </td>                      
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>         
                </div>
            </div>
        </div>
            
	
    script.
        
        drop_menu();

         const reqBody = {
            cookie : getCookie("id")
        }

        const xhr = new XMLHttpRequest()
        xhr.onload = () => {
            const result = JSON.parse(xhr.responseText)

            var restaurant_list = result.restaurant
            console.log(restaurant_list);
            list_show(restaurant_list);
        }

        xhr.open('POST', '/restaurantsetting_select')
        xhr.setRequestHeader('Content-Type', 'application/json')
        xhr.send(JSON.stringify(reqBody))

        //매장 정보 리스트 보여줌
        function list_show(list){
            for(var i = 0; i<list.length; i++){

                const img_insert = document.querySelector("#img_insert");
                const phone_insert = document.querySelector("#phone_insert");
                const address_insert = document.querySelector("#address_insert");
                const category_insert = document.querySelector("#category_insert");

                var img = 'data:image/png;base64,'+ list[i].img
                var restaurant_name = list[i].restaurant_name
                var restaurant_address = list[i].restaurant_address
                var restaurant_phone = list[i].restaurant_phone
                var restaurant_theme = list[i].restaurant_theme

                //- console.log("restaurant_name: ", restaurant_name)


                img_insert.innerHTML = `<img src = "${img}" id="menu_img" />`
                phone_insert.innerHTML = `${restaurant_phone}`
                address_insert.innerHTML = `${restaurant_address}`
                category_insert.innerHTML = `${restaurant_theme}`
            }
        }

        //매장 설정 db에 등록 (전송 버튼 클릭시)
        function restaurant_submit() {
            const file = document.querySelector("#inputFile");
            const phone_input = document.querySelector("#inputPhone");
            const address_input = document.querySelector("#inputAddress");
            const category_dropdown = document.querySelector(".category");
            const category_input = category_dropdown.selectedOptions[0];

            const reader = new FileReader();    //1

            if(file != null && phone_input != null && address_input != null && category_input != null){

                reader.onload = () => { //3

                    var strImg = reader.result;
                    var phone = phone_input.value;
                    var address = address_input.value;
                    var category = category_input.value;


                    const payload = {
                        cookie : getCookie("id"),
                        img_base64: strImg,
                        phone: phone,
                        address : address,
                        category: category
                };

                const xhr = new XMLHttpRequest();

                xhr.onload = () => {    //4
                    const result = JSON.parse(xhr.responseText)
                    if (result.code == 1) {
                    // 끝
                        //- console.log(result.menu);
                        alert("매장 정보가 등록되었습니다.")
                        add_list(strImg,phone,address,category);

                    }else{
                        alert("매장 정보 등록 error")
                    }
                };

                xhr.open("POST", "/restaurantsetting");
                xhr.setRequestHeader('Content-Type', 'application/json')
                xhr.send(JSON.stringify(payload));
            };

                reader.readAsDataURL(file.files[0]);   //2
            } else{
                alert("사진 첨부와 빈칸을 모두 입력해주세요.")
            }
        }

        //- 메뉴 추가 버튼 클릭시 등록된 매장 정보를 보여줌(새로고침 전)
        function add_list(strImg,phone,address,category){
            
            var img = strImg
            //- console.log(strImg)
            
            const img_insert = document.querySelector("#img_insert");
            const phone_insert = document.querySelector("#phone_insert");
            const address_insert = document.querySelector("#address_insert");
            const category_insert = document.querySelector("#category_insert");
            
            img_insert.innerHTML = `<img src = "${img}" id="menu_img" />`
            phone_insert.innerHTML = `${phone}`
            address_insert.innerHTML = `${address}`
            category_insert.innerHTML = `${category}`
        }
        

</body>
</html>